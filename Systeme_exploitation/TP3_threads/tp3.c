#include <pthread.h>
#include <semaphore.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h> //Header file for sleep(). man 3 sleep for details.
pthread_mutex_t pmutex = 0;
pthread_mutex_t pmutex2 = 0;
sem_t mutex;
sem_t sem;



// Non synchronisé
void* thread1 (){

    sleep(1);
    printf("Je ");

    sleep(10);
    printf("mes ");
    return 0;
}

void* thread2 (){

    sleep(5);
    printf("synchronise ");

    sleep(1);
    printf("threads.");
    return 0;
}

// Synchronisé mutex
void* thread1_sync_mutex (){

    sleep(1);
    printf("Je");
    pthread_mutex_unlock(&pmutex2);


    pthread_mutex_lock(&pmutex);
    sleep(1);
    printf("mes ");
    pthread_mutex_unlock(&pmutex);

    return 0;
}

void* thread2_sync_mutex (){

    pthread_mutex_lock(&pmutex2);
    sleep(1);
    printf("synchronise ");

    pthread_mutex_lock(&pmutex);
    sleep(1);
    printf("threads.\n");


    return 0;
}

// Synchronisé sémaphore
void* thread1_sync_sem (){

    sleep(1);
    printf("Je");

    sleep(1);
    printf("mes");
    return 0;
}

void* thread2_sync_sem (){

    sleep(1);
    printf("synchronise");

    sleep(1);
    printf("threads");
    return 0;
}




int main(){

    if (pthread_mutex_init(&pmutex, NULL) != 0) {
        printf("\n Initialisation du mutex échouée \n");
        return 1;
    }

    pthread_t thread_id, thread2_id;
    // pthread_t thread1_sync_mutex, thread2_sync_mutex;
    // Nettoyer l'écran avant d'exécuter le programme
    #ifdef _WIN32
        system("cls"); // Commande pour Windows
    #else
        system("clear"); // Commande pour Linux/macOS
    #endif

    printf("Choix de la version à lancer : ");
    int choix;
    scanf("%d", &choix);
    switch (choix)
    {
    case 1:
        printf("Threads non synchronisés : ");
        pthread_create(&thread_id, NULL,thread1, NULL);
        pthread_create(&thread2_id, NULL,thread2, NULL);
        break;

    case 2:
        printf("Threads synchronisés par mutex : ");
        pthread_create(&thread_id,NULL,thread1_sync_mutex, NULL);
        pthread_create(&thread2_id, NULL, thread2_sync_mutex, NULL);
        break;

    case 3:
        printf("Threads synchronisés par sémaphore : ");
        pthread_create(&thread_id, NULL,thread1_sync_mutex, NULL);
        pthread_create(&thread2_id, NULL, thread2_sync_mutex, NULL);
        break;

    case 4:
        printf("Toutes les séquences à la suite : ");
        // pthread_create(&thread1,NULL,thread1, NULL);
        // pthread_create(&thread2, NULL, thread2, NULL);

        // pthread_create(&thread1_sync_mutex,NULL,thread1_sync_mutex, NULL);
        // pthread_create(&thread2_sync_mutex, NULL, thread2_sync_mutex, NULL);

        // pthread_create(&thread1_sync_mutex,NULL,thread1_sync_mutex, NULL);
        // pthread_create(&thread2_sync_mutex, NULL, thread2_sync_mutex, NULL);
        break;

    case 5:
        exit(0);
        break;

    default:
        printf("Veuillez entrer un chiffre entre [ 1 - 4 ]\n");
        break;
    }

    pthread_join(thread_id, NULL);
    pthread_join(thread2_id, NULL);

    pthread_mutex_destroy(&pmutex);
}