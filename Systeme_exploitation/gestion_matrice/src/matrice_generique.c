#include "C:\Users\Muken\Documents\EfreiS2\GIT\Systeme_exploitation\gestion_matrice\include\matrices_float.h"

// Fonction pour allouer dynamiquement une matrice
matrice_float_t* allouer_matrice(int rows, int cols) {
    matrice_float_t *mat = (matrice_float_t*)malloc(sizeof(matrice_float_t));
    if (!mat) return NULL;

    mat->rows = rows;
    mat->cols = cols;
    mat->data = (float*)malloc(rows * cols * sizeof(float));

    if (!mat->data) {
        free(mat);
        return NULL;
    }

    return mat;
}

// Fonction pour saisir les coefficients d'une matrice
void saisir_matrice(matrice_float_t *mat) {
    if (!mat || !mat->data) return;
    
    printf("Entrez les coefficients de la matrice (%d x %d) :\n", mat->rows, mat->cols);
    for (int i = 0; i < mat->rows; i++) {
        for (int j = 0; j < mat->cols; j++) {
            printf("mat[%d][%d] = ", i, j);
            scanf("%f", &mat->data[i * mat->cols + j]);
        }
    }
}

// Fonction pour afficher une matrice
void afficher_matrice(const matrice_float_t *mat) {
    if (!mat || !mat->data) return;

    printf("Matrice (%d x %d) :\n", mat->rows, mat->cols);
    for (int i = 0; i < mat->rows; i++) {
        for (int j = 0; j < mat->cols; j++) {
            printf("%8.2f ", mat->data[i * mat->cols + j]);
        }
        printf("\n");
    }
}

// Fonction pour effectuer le produit matriciel
matrice_float_t* produit_matrices(const matrice_float_t *mat1, const matrice_float_t *mat2) {
    if (!mat1 || !mat2 || !mat1->data || !mat2->data) return NULL;
    if (mat1->cols != mat2->rows) return NULL; // Vérification de compatibilité

    matrice_float_t *result = allouer_matrice(mat1->rows, mat2->cols);
    if (!result) return NULL;

    for (int i = 0; i < mat1->rows; i++) {
        for (int j = 0; j < mat2->cols; j++) {
            result->data[i * result->cols + j] = 0;
            for (int k = 0; k < mat1->cols; k++) {
                result->data[i * result->cols + j] += mat1->data[i * mat1->cols + k] * mat2->data[k * mat2->cols + j];
            }
        }
    }

    return result;
}

// Fonction pour désallouer une matrice
void desallouer_matrice(matrice_float_t *mat) {
    if (!mat) return;

    free(mat->data);
    mat->data = NULL;
    free(mat);
}
