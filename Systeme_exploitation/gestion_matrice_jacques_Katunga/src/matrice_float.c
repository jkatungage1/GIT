#include "matrices_float.h"

// fonction pour allouer un objet matrice_float
matrice_float_t* allouer_matrice(int lignes, int colonnes) {
    matrice_float_t *mat = (matrice_float_t*)malloc(sizeof(matrice_float_t));
    if (!mat) return NULL;

    mat->lignes = lignes;
    mat->colonnes = colonnes;
    mat->data = (float*)malloc(lignes * colonnes * sizeof(float));

    if (!mat->data) {
        free(mat);
        return NULL;
    }

    return mat;
}

// récupération des coefficients d'une matrice
void saisir_matrice(matrice_float_t *mat) {
    if (!mat || !mat->data) return;

    printf("Entrez les coefficients de la matrice (%d x %d) :\n", mat->lignes, mat->colonnes);
    for (int i = 0; i < mat->lignes; i++) {
        for (int j = 0; j < mat->colonnes; j++) {
            printf("mat[%d][%d] = ", i, j);
            scanf("%f", &mat->data[i * mat->colonnes + j]);
        }
    }
}

// fonction pour afficher la matrice
void afficher_matrice(const matrice_float_t *mat) {
    if (!mat || !mat->data) return;

    printf("Matrice (%d x %d) :\n", mat->lignes, mat->colonnes);
    for (int i = 0; i < mat->lignes; i++) {
        for (int j = 0; j < mat->colonnes; j++) {
            printf("%8.2f ", mat->data[i * mat->colonnes + j]);
        }
        printf("\n");
    }
}

// fonction pour effectuer le produit matriciel
matrice_float_t* produit_matrices(const matrice_float_t *mat1, const matrice_float_t *mat2) {
    if (!mat1 || !mat2 || !mat1->data || !mat2->data) return NULL;
    if (mat1->colonnes != mat2->lignes) return NULL; 
    matrice_float_t *result = allouer_matrice(mat1->lignes, mat2->colonnes);
    if (!result) return NULL;

    for (int i = 0; i < mat1->lignes; i++) {
        for (int j = 0; j < mat2->colonnes; j++) {
            result->data[i * result->colonnes + j] = 0;
            for (int k = 0; k < mat1->colonnes; k++) {
                result->data[i * result->colonnes + j] += mat1->data[i * mat1->colonnes + k] * mat2->data[k * mat2->colonnes + j];
            }
        }
    }

    return result;
}

// Fonction pour désallouer une matrice
void desallouer_matrice(matrice_float_t *mat) {
    if (!mat) return;

    free(mat->data);
    mat->data = NULL;
    free(mat);
}
